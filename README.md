# ë„¥ìŠ¨ - ì´ë²¤íŠ¸ / ë³´ìƒ ê´€ë¦¬ í”Œë«í¼ êµ¬ì¶•

## ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [ê°œë°œ ì² í•™ ë° ì ‘ê·¼ ë°©ì‹](#ê°œë°œ-ì² í•™-ë°-ì ‘ê·¼-ë°©ì‹)
3. [Clean + Layered ì•„í‚¤í…ì²˜ ì ìš©](#Clean-+-Layered-í‚¤í…ì²˜-ì ìš©)
4. [ì‹œìŠ¤í…œ êµ¬ì„±](#ì‹œìŠ¤í…œ-êµ¬ì„±)
5. [êµ¬í˜„ ê³ ë ¤ì‚¬í•­ ë° ì„¤ê³„ ê²°ì •](#êµ¬í˜„-ê³ ë ¤ì‚¬í•­-ë°-ì„¤ê³„-ê²°ì •)
6. [ì‹œì‘í•˜ê¸°](#ì‹œì‘í•˜ê¸°)
7. [API ë¬¸ì„œ](#api-ë¬¸ì„œ)
8. [í–¥í›„ ë°œì „ ë°©í–¥](#í–¥í›„-ë°œì „-ë°©í–¥)

---

## í”„ë¡œì íŠ¸ ê°œìš”

ë³¸ ì‹œìŠ¤í…œì€ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ ë° ë³´ìƒ ê´€ë¦¬ í”Œë«í¼ì…ë‹ˆë‹¤. ìš´ì˜ìê°€ ì •ì˜í•œ ë£°ì— ë”°ë¼ ìœ ì € í–‰ë™ì„ ì¶”ì í•˜ê³  ì¡°ê±´ ë‹¬ì„± ì‹œ ìë™ìœ¼ë¡œ ë˜ëŠ” ìš´ì˜ì ìŠ¹ì¸ì„ í†µí•´ ë³´ìƒì„ ì§€ê¸‰í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ê°œë°œ ì² í•™ ë° ì ‘ê·¼ ë°©ì‹

### ê°œë°œ ì›ì¹™

ì´ í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ë©´ì„œ ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê°œì¸ì ì¸ ê°œë°œ ì›ì¹™ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤:

1. **ë‹¤ì´ì–´ê·¸ë¨ ì£¼ë„ ì„¤ê³„**: ì½”ë“œ ì‘ì„± ì „ì— ERD, ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨, ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì„ ë¨¼ì € ì‘ì„±í•˜ì—¬ ì„¤ê³„ ê²€ì¦ì„ ìš°ì„ ì‹œí–ˆìŠµë‹ˆë‹¤.
2. **ì§€ì†ì  ë¦¬íŒ©í† ë§**: 'ì‘ë™í•˜ëŠ”' ì½”ë“œì—ì„œ 'ì¢‹ì€' ì½”ë“œë¡œ ë°œì „ì‹œí‚¤ê¸° ìœ„í•´ ì‘ì€ë‹¨ìœ„ë¡œ ì§€ì†ì ì¸ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.
3. **ì‹¤ë¬´ ì§€í–¥ ì„¤ê³„**: ë‹¨ìˆœíˆ ê³¼ì œ ì™„ì„±ì„ ë„˜ì–´ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë“¤ì„ ê³ ë ¤í–ˆìŠµë‹ˆë‹¤.

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì ‘ê·¼ ë°©ì‹

ë³¸ í”„ë¡œì íŠ¸ëŠ” ê³¼ì œ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì´ ì•„í‚¤í…ì²˜ë¥¼ í™œìš©í•˜ë©´ì„œ ì œê°€ ìƒê°í•œ ì¥ì ê³¼ êµ¬í˜„ ë°©í–¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **í™•ì¥ì„±**: ì‚¬ìš©ì ì¦ê°€ì— ë”°ë¼ Auth ì„œë²„ì™€ Event ì„œë²„ë¥¼ ë…ë¦½ì ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆì–´ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. **ìœ ì—°í•œ ê°œë°œê³¼ ë°°í¬**: ê° ì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œí•˜ê³  ë°°í¬í•  ìˆ˜ ìˆì–´ ì´ë²¤íŠ¸ ì„œë²„ì˜ ê·œì¹™ ì—”ì§„ ìˆ˜ì •ì´ ì¸ì¦ ì‹œìŠ¤í…œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
3. **ì¥ì•  ê²©ë¦¬**: ì‹¤ì œ ìš´ì˜ í™˜ê²½ì˜ ì¤‘ìš”í•œ ë¶€ë¶„ì¸ë°, íŠ¹ì • ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•´ë„ ì¸ì¦ ì‹œìŠ¤í…œì€ ê³„ì† ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ê¸°ìˆ  ì„ íƒì˜ ììœ **: ê° ë„ë©”ì¸ì— ìµœì í™”ëœ ê¸°ìˆ  ì„ íƒì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì´ë²ˆ êµ¬í˜„ì—ì„œëŠ” ì¼ê´€ì„±ì„ ìœ„í•´ NestJSë¡œ í†µì¼í–ˆìŠµë‹ˆë‹¤.
5. **íŒ€ í˜‘ì—… êµ¬ì¡°**: ì‹¤ë¬´ì—ì„œëŠ” ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë³„ë¡œ ë‹´ë‹¹ íŒ€ì„ êµ¬ì„±í•˜ì—¬ ë…ë¦½ì ì¸ ê°œë°œ ì‚¬ì´í´ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Clean + Layered ì•„í‚¤í…ì²˜ ì ìš©

ì‹œìŠ¤í…œì˜ ë‚´ë¶€ êµ¬ì¡°ëŠ” í´ë¦° ì•„í‚¤í…ì²˜ì™€ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì˜ ì¥ì ì„ ê²°í•©í•œ Clean+Layered ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì´ë¡ ì  ìˆœìˆ˜ì„±ë³´ë‹¤ ì‹¤ë¬´ì—ì„œì˜ íš¨ìœ¨ì„±ê³¼ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ê¸° ìœ„í•œ ì„ íƒì´ì—ˆìŠµë‹ˆë‹¤.

### ìˆœìˆ˜í•œ í´ë¦° ì•„í‚¤í…ì²˜ì™€ ì‹¤ë¬´ì—ì„œì˜ ì–´ë ¤ì›€

ìˆœìˆ˜í•œ í´ë¦° ì•„í‚¤í…ì²˜ëŠ” ì´ë¡ ì ìœ¼ë¡œ ì™„ë²½í•˜ì§€ë§Œ, ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì´ ìˆì—ˆìŠµë‹ˆë‹¤:

1. **ê°œë°œ ìƒì‚°ì„± ì €í•˜**: ì˜ì¡´ì„± ê·œì¹™ì„ ì—„ê²©í•˜ê²Œ ì§€í‚¤ê¸° ìœ„í•´ ë§ì€ ì¤‘ê°„ ê³„ì¸µê³¼ ì–´ëŒ‘í„°ë¥¼ ì‘ì„±í•´ì•¼ í•¨
2. **ê³¼ë„í•œ ë³µì¡ì„±**: ê°„ë‹¨í•œ CRUD ì‘ì—…ë„ ë‹¤ìˆ˜ì˜ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µê³¼í•˜ëŠ” ë³µì¡í•œ ê²½ë¡œ ë°œìƒ
3. **ì‹¤ìš©ì  íƒ€í˜‘ì˜ ì–´ë ¤ì›€**: í”„ë ˆì„ì›Œí¬ íŠ¹ì„±(NestJSì˜ ë°ì½”ë ˆì´í„° ë“±)ì„ í™œìš©í•˜ê¸° ì–´ë ¤ì›€

### Clean+Layeredì˜ ì‹¤ìš©ì  ì ‘ê·¼

ì´ëŸ° ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´, ë‹¤ìŒ ì›ì¹™ì„ ë”°ë¥´ëŠ” Clean+Layered ì•„í‚¤í…ì²˜ë¥¼ ê³ ì•ˆí–ˆìŠµë‹ˆë‹¤:

| í•­ëª© | ì„¤ëª… |
|------|------|
| **í•µì‹¬ ë„ë©”ì¸ ìˆœìˆ˜ì„±** | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì™¸ë¶€ í”„ë ˆì„ì›Œí¬ë‚˜ DB ì˜ì¡´ ì—†ì´ ìˆœìˆ˜ TypeScriptë¡œ êµ¬í˜„ |
| **ê³„ì¸µ ê°„ ì±…ì„ êµ¬ë¶„** | Presentation -> Application -> Domain <- Infrastructureë¡œ ì—­í• ê³¼ ì±…ì„ì„ ëª…í™•íˆ ë¶„ë¦¬ |
| **ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ ìš”ì†Œ** | Entity, DomainService ë“± ì ê·¹ ë„ì… |
| **í”„ë ˆì„ì›Œí¬ í™œìš©ê³¼ ê²©ë¦¬ì˜ ê· í˜•** | NestJSì˜ ìœ í‹¸ë¦¬í‹°(Guard, Decorator ë“±)ëŠ” í™œìš©í•˜ë˜ ë„ë©”ì¸ ë¡œì§ì€ ê²©ë¦¬ |
| **ë‹¨ë°©í–¥ ì˜ì¡´ì„± ìœ ì§€** | ì™¸ë¶€ â†’ ë‚´ë¶€ ë°©í–¥ì˜ ì˜ì¡´ì„±ë§Œ í—ˆìš©í•˜ì—¬ êµ¬ì¡°ì  ì•ˆì •ì„± í™•ë³´ |
| **ê¸°ìˆ  ë³€í™” ëŒ€ì‘ë ¥** | Mongo â†’ ë‹¤ë¥¸ DBë¡œ êµì²´í•˜ê±°ë‚˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ë³€ê²½ ì‹œì—ë„ ë„ë©”ì¸ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥ |
| **ìœ ì§€ë³´ìˆ˜ ì¤‘ì‹¬** | ë³€ê²½ì´ ì¦ì€ ë„ë©”ì¸(ì´ë²¤íŠ¸/ë³´ìƒ ê·œì¹™)ì„ ë¹ ë¥´ê²Œ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ |

### ê³„ì¸µ êµ¬ì¡°ì™€ ì±…ì„ ì •ì˜

ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ (Presentation Layer)**
   - **ìœ„ì¹˜**: `apps/*/src/presentation/`
   - **ì±…ì„**: HTTP ìš”ì²­ ì²˜ë¦¬, ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬, ê¶Œí•œ ê²€ì¦, ì‘ë‹µ í¬ë§·íŒ…
   - **ê¸°ìˆ **: NestJS ì»¨íŠ¸ë¡¤ëŸ¬, DTO, ì¸í„°ì…‰í„°, í•„í„°
   - **ì˜ˆì‹œ**: `EventController`ì—ì„œ ì´ë²¤íŠ¸ ìƒì„± API ì—”ë“œí¬ì¸íŠ¸ ì²˜ë¦¬

2. **ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ (Application Layer)**
   - **ìœ„ì¹˜**: `apps/*/src/application/`
   - **ì±…ì„**: ìœ ìŠ¤ì¼€ì´ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ë„ë©”ì¸ ì„œë¹„ìŠ¤ ì¡°í•©
   - **ê¸°ìˆ **: í¼ì‚¬ë“œ íŒ¨í„´, CQRS, ì´ë²¤íŠ¸ ë°œí–‰
   - **ì˜ˆì‹œ**: `EventFacade`ì—ì„œ ì´ë²¤íŠ¸ ìƒì„± í”„ë¡œì„¸ìŠ¤ ì¡°ì •

3. **ë„ë©”ì¸ ê³„ì¸µ (Domain Layer)**
   - **ìœ„ì¹˜**: `apps/*/src/domain/`
   - **ì±…ì„**: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ê·œì¹™, ì—”í‹°í‹°, ê°’ ê°ì²´ ì •ì˜
   - **ê¸°ìˆ **: ìˆœìˆ˜ TypeScript í´ë˜ìŠ¤, ì¸í„°í˜ì´ìŠ¤, íƒ€ì…
   - **ì˜ˆì‹œ**: `EventEntity`ì—ì„œ ì´ë²¤íŠ¸ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ êµ¬í˜„

4. **ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µ (Infrastructure Layer)**
   - **ìœ„ì¹˜**: `apps/*/src/infrastructure/`, `libs/infrastructure/`
   - **ì±…ì„**: ì˜ì†ì„±, ì™¸ë¶€ ì„œë¹„ìŠ¤ í†µí•©, ê¸°ìˆ ì  êµ¬í˜„
   - **ê¸°ìˆ **: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ìºì‹±, ë©”ì‹œì§•, ë¡œê¹…
   - **ì˜ˆì‹œ**: `MongoEventRepository`ì—ì„œ ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ ë° ì¡°íšŒ

---

### ì˜ì¡´ì„± ê·œì¹™ê³¼ íë¦„

í´ë¦°+ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ì€ ì˜ì¡´ì„± ë°©í–¥ ì œì–´ì…ë‹ˆë‹¤:

```
[ì™¸ë¶€ ê³„ì¸µ] â†’ [ë‚´ë¶€ ê³„ì¸µ]
í”„ë ˆì  í…Œì´ì…˜ â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ë„ë©”ì¸ â† ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜
```

ì£¼ëª©í•  ì ì€ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê³„ì¸µì´ ë„ë©”ì¸ ê³„ì¸µì— ì˜ì¡´í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤:

```typescript
// domain/repositories/event-repository.interface.ts
export interface EventRepository {
  findByUserId(userId: string): Promise<Event[]>;
  save(event: Event): Promise<void>;
}

// infrastructure/repositories/mongo-event.repository.ts
@Injectable()
export class MongoEventRepository implements EventRepository {
  constructor(
    @InjectModel(EventModel.name) private eventModel: Model<EventDocument>
  ) {}
  
  async findByUserId(userId: string): Promise<Event[]> {
    const events = await this.eventModel.find({ userId }).exec();
    return events.map(event => this.mapToEntity(event));
  }
  
  async save(event: Event): Promise<void> {
    await this.eventModel.updateOne(
      { id: event.id },
      this.mapToDocument(event),
      { upsert: true }
    );
  }
  
  private mapToEntity(doc: EventDocument): Event {
    // ë¬¸ì„œì—ì„œ ë„ë©”ì¸ ì—”í‹°í‹°ë¡œ ë³€í™˜
  }
  
  private mapToDocument(entity: Event): Record<string, any> {
    // ë„ë©”ì¸ ì—”í‹°í‹°ì—ì„œ ë¬¸ì„œë¡œ ë³€í™˜
  }
}
```

ì´ë¥¼ í†µí•´ ë„ë©”ì¸ ê³„ì¸µì€ êµ¬ì²´ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ì— ì˜ì¡´í•˜ì§€ ì•Šìœ¼ë©°, í•„ìš”ì‹œ ë‹¤ë¥¸ ì €ì¥ì†Œë¡œ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Clean+Layered ì•„í‚¤í…ì²˜ì˜ ì‹¤ë¬´ ì´ì 

ì´ ì•„í‚¤í…ì²˜ë¥¼ ì ìš©í•¨ìœ¼ë¡œì¨ ì–»ì€ ì‹¤ì§ˆì ì¸ ì´ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì™¸ë¶€ ì˜ì¡´ì„±ìœ¼ë¡œë¶€í„° ë³´í˜¸ë˜ì–´ ì•ˆì •ì ì¸ ì‹œìŠ¤í…œ êµ¬ì¶•
2. **í™•ì¥ì„± í™•ë³´**: ì‹œìŠ¤í…œ ì¼ë¶€ë§Œ ìˆ˜ì •í•˜ê±°ë‚˜ í™•ì¥í•˜ëŠ” ê²ƒì´ ìš©ì´í•¨
3. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì˜ì¡´ì„± ì—†ì´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
4. **ê°œë°œ ìƒì‚°ì„± ìœ ì§€**: ê³¼ë„í•œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ì—†ì´ í´ë¦° ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì›ì¹™ ì¤€ìˆ˜
5. **ê¸°ìˆ  ë¶€ì±„ ìµœì†Œí™”**: ëª…í™•í•œ êµ¬ì¡°ë¡œ ì¸í•´ ìƒˆë¡œìš´ ê°œë°œìë„ ì‰½ê²Œ ì½”ë“œë² ì´ìŠ¤ ì´í•´ ê°€ëŠ¥

ì´ëŸ¬í•œ Clean+Layered ì•„í‚¤í…ì²˜ëŠ” ìˆœìˆ˜í•œ ì´ë¡ ì  ì ‘ê·¼ë³´ë‹¤ ì‹¤ë¬´ í™˜ê²½ì—ì„œ í›¨ì”¬ ë” íš¨ê³¼ì ìœ¼ë¡œ ì‘ë™í•˜ë©°, íŒ€ì˜ ìƒì‚°ì„±ê³¼ ì½”ë“œ í’ˆì§ˆì„ ë™ì‹œì— ë†’ì¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

## ì‹œìŠ¤í…œ êµ¬ì„±

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì„±

ë³¸ ì‹œìŠ¤í…œì€ 3ê°œì˜ í•µì‹¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **API Gateway (Port 3000)**
   - ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ì§„ì…ì 
   - API ë¬¸ì„œí™”
   - ì¸ì¦ ë° ê¶Œí•œ ê²€ì¦
   - ìš”ì²­ ë¼ìš°íŒ… ë° ë¡œë“œ ë°¸ëŸ°ì‹±

2. **Auth Service (Port 3001)**
   - ì‚¬ìš©ì ë“±ë¡ ë° ì¸ì¦
   - JWT í† í° ê´€ë¦¬
   - ì—­í•  ë° ê¶Œí•œ ê´€ë¦¬

3. **Event Service (Port 3002)**
   - ì´ë²¤íŠ¸ ë° ë³´ìƒ ê´€ë¦¬
   - ì´ë²¤íŠ¸ ì¡°ê±´ ê²€ì¦
   - ë³´ìƒ ìš”ì²­ ì²˜ë¦¬

### ì£¼ìš” ë„ë©”ì¸ ëª¨ë¸

1. **Event (ì´ë²¤íŠ¸)**: ì´ë²¤íŠ¸ ì •ë³´ ë° ì¡°ê±´ ì •ì˜
   - ì¡°ê±´ íƒ€ì… (ë¡œê·¸ì¸, ì´ˆëŒ€ ë“±)
   - ì¡°ê±´ ë§¤ê°œë³€ìˆ˜ (í•„ìš”í•œ ë¡œê·¸ì¸ ì¼ìˆ˜, ì´ˆëŒ€ ì¸ì› ë“±)
   - í™œì„± ìƒíƒœ ë° ê¸°ê°„

2. **Reward (ë³´ìƒ)**: ì´ë²¤íŠ¸ ë‹¬ì„± ì‹œ ì œê³µë˜ëŠ” í˜œíƒ
   - ë³´ìƒ íƒ€ì… (ì•„ì´í…œ, í¬ì¸íŠ¸ ë“±)
   - ë³´ìƒ ë§¤ê°œë³€ìˆ˜ (ìˆ˜ëŸ‰, ë§Œë£Œ ê¸°ê°„ ë“±)
   - ìŠ¹ì¸ ìš”êµ¬ ì—¬ë¶€

3. **RewardClaim (ë³´ìƒ ì²­êµ¬)**: ìœ ì €ì˜ ë³´ìƒ ìš”ì²­ ë° ì²˜ë¦¬ ìƒíƒœ
   - ì²˜ë¦¬ ìƒíƒœ (ëŒ€ê¸°, ìŠ¹ì¸, ê±°ë¶€, ì™„ë£Œ)
   - ìŠ¹ì¸ì ì •ë³´
   - ì²˜ë¦¬ ì‹œê°„

## êµ¬í˜„ ê³ ë ¤ì‚¬í•­ ë° ì„¤ê³„ ê²°ì •

#### ìë™ ë³´ìƒ í”„ë¡œì„¸ìŠ¤ (ìœ ì € íšŒì›ê°€ì… ì´ë²¤íŠ¸ ê¸°ë°˜)
1. ìœ ì € í–‰ë™ ë°ì´í„° ìˆ˜ì§‘ (user_events)
2. ê·œì¹™ ì—”ì§„ì—ì„œ ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€ í‰ê°€
3. ìœ ì €ì˜ ë³´ìƒ ìš”ì²­ â†’ Gateway â†’ Event Server
4. ìê²© ì¡°ê±´ ì¶©ì¡± ì‹œ ìë™ ìŠ¹ì¸ ë° ë³´ìƒ ì§€ê¸‰ ì²˜ë¦¬
5. ì´ë ¥ ê¸°ë¡ ë° ë¶„ì‚° ë½ í•´ì œ

#### ìˆ˜ë™ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ (ìœ ì € ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ê¸°ë°˜)
1. ìœ ì € í–‰ë™ ë°ì´í„° ìˆ˜ì§‘ (user_events)
1. ìœ ì €ì˜ ë³´ìƒ ìš”ì²­ â†’ Gateway â†’ Event Server
2. 1ì°¨ ìê²© ê²€ì¦ (ì¤‘ë³µ ìš”ì²­ ë°©ì§€)
3. ìš´ì˜ì ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜
4. ìš´ì˜ì ê²€í†  ë° ìŠ¹ì¸/ê±°ë¶€ ê²°ì •
5. ë³´ìƒ ì§€ê¸‰ ì²˜ë¦¬ ë° ìƒíƒœ ì—…ë°ì´íŠ¸

#### Rule ê¸°ë°˜ ë³´ìƒ ì²˜ë¦¬ ì„¤ê³„

- ëª¨ë“  ì´ë²¤íŠ¸ ë° ë³´ìƒ íë¦„ì€ `Rule` ê°ì²´ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
- ê° Ruleì€ ë‹¤ìŒ ìš”ì†Œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:
  - `trigger`: ì–´ë–¤ ì´ë²¤íŠ¸ì— ë°˜ì‘í• ì§€ ì •ì˜
  - `condition`: ìœ ì €ì˜ í–‰ë™ ì¡°ê±´ (ì˜ˆ: ë¡œê·¸ì¸ íšŸìˆ˜, ì´ˆëŒ€ ì¸ì›)
  - `action`: ì§€ê¸‰í•  ë³´ìƒ ì •ë³´
  - `approvalRequired`: ìë™ ì§€ê¸‰ ë˜ëŠ” ìš´ì˜ì ìŠ¹ì¸ ì—¬ë¶€
- Ruleì€ MongoDBì— ì €ì¥ë˜ë©° í•« ë¦¬ë¡œë”© í˜¹ì€ ìºì‹œ ì ìš©ì„ ê³ ë ¤í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.
- ì¡°ê±´ í‰ê°€ ë°©ì‹ì€ ì „ëµ íŒ¨í„´ ê¸°ë°˜ìœ¼ë¡œ, ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ìœ í˜•ì— ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ë„ë©”ì¸ ê°„ ì—°ë™ & í¼ì‚¬ë“œ ê³„ì¸µ

ê° ë„ë©”ì¸(app)ì€ ë…ë¦½ì„±ì„ ìœ ì§€í•˜ì§€ë§Œ, ë³µí•© ìœ ì¦ˆì¼€ì´ìŠ¤ëŠ” `Facade` ê³„ì¸µì—ì„œ orchestrationí•©ë‹ˆë‹¤.

ì˜ˆì‹œ: `EventFacade`ê°€ ë³´ìƒ íë¦„ ì „ì²´ë¥¼ ì¡°ìœ¨í•©ë‹ˆë‹¤.

```ts
class EventFacade {
  async handleEventReport(eventType, userId) {
    const rules = await this.ruleRepo.findByTrigger(eventType);
    for (const rule of rules) {
      const ok = await this.evaluator.evaluate(rule, userId);
      if (ok) {
        rule.approvalRequired
          ? await this.rewardService.queueForApproval(rule, userId)
          : await this.rewardService.grantImmediateReward(rule, userId);
      }
    }
  }
}
```
ì´ ë°©ì‹ì€:

- ìœ ì € ì´ë²¤íŠ¸ íë¦„ì„ í•˜ë‚˜ì˜ ì§„ì…ì ì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê³ ,
- ê° ë„ë©”ì¸ì˜ ì±…ì„ì„ ë¶„ë¦¬í•˜ë©´ì„œë„ ìœ ìŠ¤ì¼€ì´ìŠ¤ êµ¬í˜„ì€ ê°„ê²°í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.

#### í…ŒìŠ¤íŠ¸ ì „ëµ ìš”ì•½

- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)**:  
  RuleEvaluator, RewardExecutor ë“± í•µì‹¬ ë¡œì§ì€ ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±

- **í†µí•© í…ŒìŠ¤íŠ¸ (Integration Test)**:  
  `curl + docker-compose` í™˜ê²½ì—ì„œ ì‹¤ì œ íë¦„ì„ ê²€ì¦í•˜ëŠ” `AUTOMATED_INTEGRATION_TEST.sh` ìŠ¤í¬ë¦½íŠ¸ ì œê³µ

- **í…ŒìŠ¤íŠ¸ ì„¤ê³„ ê³ ë ¤ì‚¬í•­**:
  - ì˜ì¡´ì„± ì£¼ì…ì„ í†µí•´ mock ì£¼ì… ê°€ëŠ¥
  - Guard ë° ì¸ì¦ íë¦„ì€ í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ ê²€ì¦
  - Reward ì¤‘ë³µ ë°©ì§€ ë¡œì§, ìš´ì˜ì ìŠ¹ì¸ ë¶„ê¸° ë“± í•µì‹¬ íë¦„ì— ì§‘ì¤‘

## ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Docker ë° Docker Compose ì„¤ì¹˜
- Node.js 18 ì´ìƒ

### ì„¤ì¹˜ ë° ì‹¤í–‰

#### Docker Compose ì‚¬ìš©

```
# í”„ë¡œì íŠ¸ í´ë¡ 
git clone https://github.com/your-username/Nexon-Event-Reward-System.git
cd Nexon-Event-Reward-System

# Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker-compose up -d

# ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps

# ì„œë¹„ìŠ¤ í™•ì¸:
- Gateway API: http://localhost:3000
- MongoDB: localhost:27017
- MongoDB Express(ê´€ë¦¬ì UI): http://localhost:8081
- Redis: localhost:6379

### MongoDB ì ‘ì† ë°©ë²•
- **MongoDB Express**: http://localhost:8081 ì ‘ì†í•˜ì—¬ ì›¹ ê¸°ë°˜ ê´€ë¦¬ ë„êµ¬ ì‚¬ìš©
- **MongoDB Compass**: MongoDB ê³µì‹ GUI ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ `mongodb://localhost:27017` ì£¼ì†Œë¡œ ì—°ê²°
- **MongoDB Shell**: ì»¤ë§¨ë“œë¼ì¸ì—ì„œ `mongosh mongodb://localhost:27017/nexon-event-system` ëª…ë ¹ì–´ë¡œ ì—°ê²°

```

#### ìë™í™”ëœ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

`AUTOMATED_INTEGRATION_TEST.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ì‹œìŠ¤í…œì˜ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ (íšŒì›ê°€ì…, ë¡œê·¸ì¸)
2. ì—­í•  ê¸°ë°˜ ê¶Œí•œ ê²€ì¦ (ê´€ë¦¬ì, ì¼ë°˜ ì‚¬ìš©ì, ê°ì‚¬ì)
3. ì´ë²¤íŠ¸, ë³´ìƒ ìƒì„± ë° ê´€ë¦¬ (íšŒì›ê°€ì…, ë¡œê·¸ì¸ ê¸°ë°˜ ì´ë²¤íŠ¸ ë° ë³´ìƒ)
4. ë³´ìƒ ì²­êµ¬ ë° ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ (ìˆ˜ë™, ìë™)
5. ì¤‘ë³µ ìš”ì²­ ë°©ì§€ ê²€ì¦
6. ê°ì‚¬ì ì—­í•  ê²€ì¦

| ![í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ 1](./docs/AUTOMATED_INTEGRATION_TEST_01.png) | ![í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ 2](./docs/AUTOMATED_INTEGRATION_TEST_02.png) |
|:---:|:---:|
| í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ 1 | í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ 2 |

## API ë¬¸ì„œ

ê° ì„œë¹„ìŠ¤ì— ëŒ€í•œ Swagger API ë¬¸ì„œë¥¼ ì œê³µí•©ë‹ˆë‹¤:

- Gateway API Docs: http://localhost:3000/api/docs
- local curl Test guide: [MANUAL_API_TEST_GUIDE](./docs/MANUAL_API_TEST_GUIDE.md)


## í–¥í›„ ë°œì „ ë°©í–¥
1. **Redis ê³ ê°€ìš©ì„± ì•„í‚¤í…ì²˜ êµ¬í˜„**
   - Master-Slave ë³µì œ êµ¬ì¡° ë„ì…ìœ¼ë¡œ ì½ê¸° ì„±ëŠ¥ í–¥ìƒ
   - Redis Sentinelìœ¼ë¡œ ìë™ ì¥ì•  ë³µêµ¬ ì²´ê³„ êµ¬ì¶•

2. **ë©”ì‹œì§€ í ì‹œìŠ¤í…œ ê³ ë„í™”**
   - Kafka ê¸°ë°˜ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° í”Œë«í¼ êµ¬ì¶•
   - ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬ ë° ì´ë²¤íŠ¸ ì†Œì‹± íŒ¨í„´ ì ìš©
   - ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

3. **ë£° ê¸°ë°˜ ì—”ì§„ ê³ ë„í™”**
   - ë™ì  ê·œì¹™ ì •ì˜ DSL(Domain Specific Language) ê°œë°œ
   - ê·œì¹™ ì‹œë®¬ë ˆì´ì…˜ ë° í…ŒìŠ¤íŠ¸ ë„êµ¬ ê°œë°œ
   - ì´ìƒ íƒì§€ ì‹œìŠ¤í…œ ì—°ë™

4. **ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„**
   - Socket.io ê¸°ë°˜ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì•Œë¦¼
   - í‘¸ì‹œ ì•Œë¦¼ ë° ì´ë©”ì¼ ì—°ë™ ì‹œìŠ¤í…œ êµ¬ì¶•
   - ì•Œë¦¼ ì„ í˜¸ë„ ì„¤ì • ë° ê°œì¸í™” ê¸°ëŠ¥

ì´ëŸ¬í•œ í–¥í›„ ê³„íšë“¤ì€ ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì  ë„ì „ê³¼ ëŒ€ê·œëª¨ ì‚¬ìš©ì ê¸°ë°˜ì„ ì§€ì›í•˜ê¸° ìœ„í•œ í™•ì¥ì„± ìš”êµ¬ì‚¬í•­ì„ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ˆê¸°ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í–ˆìœ¼ë‚˜, í”„ë¡œì íŠ¸ ìì› ì œì•½ìœ¼ë¡œ ì¸í•´ ì¼ë¶€ ê¸°ëŠ¥ì€ í™•ì¥ì„±ì„ ê³ ë ¤í•œ ì¸í„°í˜ì´ìŠ¤ì™€ ê¸°ë³¸ êµ¬í˜„ì²´ë§Œ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤. í–¥í›„ ì‹œìŠ¤í…œ í™•ì¥ ì‹œ ì´ëŸ¬í•œ ê¸°ë°˜ì„ í™œìš©í•˜ì—¬ ì™„ì „í•œ ê¸°ëŠ¥ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„í•˜ì˜€ìŠµë‹ˆë‹¤.

```mermaid
flowchart TD
    %% í´ë¼ì´ì–¸íŠ¸ ë…¸ë“œ
    Client(["ğŸ‘¨â€ğŸ’¼ í´ë¼ì´ì–¸íŠ¸ ì•±"]):::clientNode
    BackOffice(["ğŸ‘¨â€ğŸ’» ë°±ì˜¤í”¼ìŠ¤ UI"]):::clientNode
    
    %% í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
    Client -- "HTTP ìš”ì²­" --> Gateway
    BackOffice -- "HTTP ìš”ì²­" --> Gateway
    
    %% API ê³„ì¸µ
    subgraph ApiLayer["ğŸŒ API Layer"]
        Gateway[("API Gateway<br/>NestJS")]:::gatewayNode
    end
    
    %% ì„œë¹„ìŠ¤ ê³„ì¸µ
    subgraph ServiceLayer["ğŸ” Service Layer"]
        Auth["ğŸ”‘ Auth Service<br/>(ì‚¬ìš©ì/ì¸ì¦)"]:::serviceNode
        Event["ğŸ® Event Service<br/>(ì´ë²¤íŠ¸/ë³´ìƒ)"]:::serviceNode
    end
    
    %% ë°ì´í„° ê³„ì¸µ
    subgraph DataLayer["ğŸ’¾ Infrastructure"]
        MongoDB[(MongoDB<br/>ë°ì´í„° ì €ì¥)]:::dbNode
        Redis[(Redis<br/>ìºì‹œ/ë½)]:::cacheNode
        EventBus["ğŸ“¨ Event Bus"]:::eventNode
    end
    
    %% ì„œë¹„ìŠ¤ ë‚´ë¶€ ëª¨ë“ˆ
    subgraph EventModules["ğŸ§© Event Service Modules"]
        RuleEngine["âš™ï¸ Rule Engine"]:::moduleNode
        RewardModule["ğŸ† Reward Module"]:::moduleNode
        ValidationModule["âœ… Validation Module"]:::moduleNode
    end
    
    %% ì£¼ìš” ì—°ê²°
    Gateway -- "ì¸ì¦/ê¶Œí•œ" --> Auth
    Gateway -- "ì´ë²¤íŠ¸/ë³´ìƒ" --> Event
    Auth -- "ìœ ì € ë°ì´í„°" --> MongoDB
    Event -- "ì´ë²¤íŠ¸ ë°ì´í„°" --> MongoDB
    Event -- "ìºì‹±/ë¶„ì‚°ë½" --> Redis
    Auth -- "ì„¸ì…˜ ë°ì´í„°" --> Redis
    
    %% ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 
    Auth <---> |"ì´ë²¤íŠ¸ ë°œí–‰/êµ¬ë…"| EventBus
    Event <---> |"ì´ë²¤íŠ¸ ë°œí–‰/êµ¬ë…"| EventBus
    
    %% ëª¨ë“ˆ ì—°ê²°
    Event --- RuleEngine
    Event --- RewardModule
    Event --- ValidationModule
    
    %% ìŠ¤íƒ€ì¼ ì •ì˜
    classDef clientNode fill:#ff9eb1,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    classDef gatewayNode fill:#9ea1ff,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    classDef serviceNode fill:#a1ffb0,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    classDef dbNode fill:#ffcc9e,stroke:#333,stroke-width:3px,color:#333,font-weight:bold
    classDef cacheNode fill:#9eceff,stroke:#333,stroke-width:3px,color:#333,font-weight:bold
    classDef moduleNode fill:#f9f39e,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    classDef eventNode fill:#dda1ff,stroke:#333,stroke-width:2px,color:#333,font-weight:bold
    
    %% ì„œë¸Œê·¸ë˜í”„ ìŠ¤íƒ€ì¼
    style ApiLayer fill:#f0f0f0,stroke:#333,stroke-width:2px
    style ServiceLayer fill:#f0f0f0,stroke:#333,stroke-width:2px
    style DataLayer fill:#f0f0f0,stroke:#333,stroke-width:2px
    style EventModules fill:#f0f0f0,stroke:#333,stroke-width:2px
```

